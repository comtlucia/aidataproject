import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

st.set_page_config(page_title="ğŸ“Š ë°ì´í„° íƒí—˜!", layout="wide")
st.title("ğŸ“ ë°ì´í„° íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ë¶„ì„í•´ì¤„ê²Œìš”!")

uploaded_file = st.file_uploader("CSV ë˜ëŠ” Excel íŒŒì¼ì„ ì˜¬ë ¤ë³´ì„¸ìš”", type=["csv", "xlsx"])

if uploaded_file:
    # íŒŒì¼ ì½ê¸°
    if uploaded_file.name.endswith('.csv'):
        df = pd.read_csv(uploaded_file)
    else:
        df = pd.read_excel(uploaded_file)

    # ë°ì´í„° ìš”ì•½
    st.subheader("ğŸ§¾ ë°ì´í„° êµ¬ì¡° ìš”ì•½")
    st.markdown(f"- ë°ì´í„° í–‰ ìˆ˜: **{df.shape[0]}**ê°œ")
    st.markdown(f"- ë°ì´í„° ì—´ ìˆ˜: **{df.shape[1]}**ê°œ")
    st.markdown(f"- ì»¬ëŸ¼ ëª©ë¡: {', '.join(df.columns)}")
    st.markdown(f"- ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” ì—´: {', '.join(df.columns[df.isnull().any()]) or 'ì—†ìŒ'}")

    # ë°ì´í„° íƒ€ì…
    st.write("ğŸ“Œ ê° ì—´ì˜ ë°ì´í„° íƒ€ì…")
    st.dataframe(df.dtypes.rename("Data Type"))

    # í†µê³„ ìš”ì•½
    st.subheader("ğŸ“ˆ ê¸°ë³¸ í†µê³„ ìš”ì•½")
    st.dataframe(df.describe())

    # ì‹œê°í™”
    st.subheader("ğŸ“Š ì»¬ëŸ¼ë³„ íˆìŠ¤í† ê·¸ë¨")
    num_cols = df.select_dtypes(include='number').columns
    for col in num_cols:
        st.markdown(f"**ğŸ”¹ {col}**")
        fig, ax = plt.subplots()
        sns.histplot(df[col].dropna(), kde=True, ax=ax)
        st.pyplot(fig)

    # ìƒìê·¸ë¦¼
    st.subheader("ğŸ“¦ ì´ìƒì¹˜ í™•ì¸ (ìƒìê·¸ë¦¼)")
    for col in num_cols:
        st.markdown(f"**ğŸ“¦ {col}**")
        fig, ax = plt.subplots()
        sns.boxplot(x=df[col], ax=ax)
        st.pyplot(fig)

    # ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ
    st.subheader("ğŸ“Œ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ")
    corr = df[num_cols].corr()
    fig, ax = plt.subplots()
    sns.heatmap(corr, annot=True, cmap='coolwarm', ax=ax)
    st.pyplot(fig)

    # ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ì¹´ë“œ
    st.subheader("ğŸ’¡ ë°ì´í„°ì—ì„œ ì•Œ ìˆ˜ ìˆëŠ” ì¸ì‚¬ì´íŠ¸")

    # í‰ê· ì´ ê°€ì¥ ë†’ì€ í•­ëª©
    mean_col = df[num_cols].mean().idxmax()
    st.success(f"âœ… **{mean_col}**ì€(ëŠ”) ë‹¤ë¥¸ í•­ëª©ë³´ë‹¤ í‰ê· ê°’ì´ ë†’ìŠµë‹ˆë‹¤. ì´ í•­ëª©ì´ ë°ì´í„°ì—ì„œ ì¤‘ìš”í•œ ê¸°ì¤€ì¼ ìˆ˜ ìˆì–´ìš”.")

    # ìƒê´€ê³„ìˆ˜ê°€ ë†’ì€ ë³€ìˆ˜ìŒ
    high_corr = corr.where(corr < 1).abs().unstack().sort_values(ascending=False).dropna()
    if not high_corr.empty:
        top_pair = high_corr.idxmax()
        st.info(f"ğŸ”— **{top_pair[0]}**ì™€ **{top_pair[1]}**ì€(ëŠ”) ê°•í•œ ìƒê´€ê´€ê³„ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”. ë‘˜ì€ í•¨ê»˜ ë³€í™”í•  ê°€ëŠ¥ì„±ì´ ë†’ì•„ìš”.")

    # ê²°ì¸¡ì¹˜ ì¸ì‚¬ì´íŠ¸
    if df.isnull().sum().sum() > 0:
        st.warning("âš ï¸ ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë¶„ì„ ì „ì— ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.")

else:
    st.info("ì™¼ìª½ì—ì„œ íŒŒì¼ì„ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.")

